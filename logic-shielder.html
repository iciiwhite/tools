<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IciiObfuscate | Professional JS Security</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Design Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { glass: 'rgba(255, 255, 255, 0.05)', accent: '#8b5cf6' }
                }
            }
        }
    </script>

    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        .glass { background: rgba(15, 15, 15, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .editor-bg { background: rgba(5, 5, 5, 0.8); border: 1px solid rgba(255,255,255,0.05); }
        .btn-primary { background: linear-gradient(135deg, #8b5cf6, #3b82f6); transition: all 0.3s ease; }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(139, 92, 246, 0.4); }
        .page { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .hidden-page { opacity: 0; transform: translateX(50px); pointer-events: none; }
        textarea { resize: none; outline: none; -webkit-user-select: text; user-select: text; }
        textarea::placeholder { color: #444; }
        /* Professional Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col">

    <!-- Background Orbs -->
    <div class="fixed inset-0 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-purple-900/20 blur-[120px] rounded-full"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-900/20 blur-[120px] rounded-full"></div>
    </div>

    <!-- Header -->
    <nav class="relative z-50 flex items-center justify-between px-6 py-4 glass border-b border-white/10">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg btn-primary flex items-center justify-center">
                <i class="fas fa-fingerprint text-white text-sm"></i>
            </div>
            <span class="text-xl font-extrabold tracking-tighter">Icii<span class="text-accent">Obfuscate</span></span>
        </div>
        <button id="pwaInstall" class="hidden text-xs font-bold border border-white/20 px-3 py-1.5 rounded-full hover:bg-white/10 transition-all">
            <i class="fas fa-plus mr-1"></i> ADD TO HOME
        </button>
    </nav>

    <!-- Main Container -->
    <main class="relative flex-1 overflow-hidden">
        
        <!-- PAGE 1: EDITOR -->
        <div id="page1" class="page p-4 md:p-8 flex flex-col gap-4">
            <div class="flex justify-between items-end">
                <div>
                    <h2 class="text-2xl font-bold">Source Code</h2>
                    <p class="text-gray-500 text-sm">Independent Engine â€¢ Secure transformation</p>
                </div>
                <div class="hidden md:block text-right">
                    <span class="text-[10px] text-accent font-mono border border-accent/30 px-2 py-1 rounded">JS_ENGINE_V2.0_STABLE</span>
                </div>
            </div>

            <div class="flex-1 relative">
                <textarea id="inputCode" class="w-full h-full p-6 rounded-2xl editor-bg font-mono text-sm leading-relaxed" spellcheck="false" placeholder="// Enter your JavaScript here..."></textarea>
                
                <button onclick="obfuscateAction()" class="absolute bottom-6 right-6 btn-primary px-8 py-4 rounded-xl font-bold flex items-center gap-3 shadow-xl">
                    <span>SECURE CODE</span>
                    <i class="fas fa-shield-alt"></i>
                </button>
            </div>
        </div>

        <!-- PAGE 2: OUTPUT -->
        <div id="page2" class="page hidden-page p-4 md:p-8 flex flex-col gap-4">
            <div class="flex items-center justify-between">
                <button onclick="switchPage(1)" class="text-sm text-gray-400 hover:text-white flex items-center gap-2">
                    <i class="fas fa-arrow-left"></i> Edit Source
                </button>
                <div class="flex gap-2">
                    <button onclick="copyCode()" class="px-4 py-2 rounded-lg glass hover:bg-white/10 text-sm font-bold flex items-center gap-2">
                        <i class="far fa-copy"></i> Copy
                    </button>
                    <button onclick="downloadCode()" class="px-4 py-2 rounded-lg btn-primary text-sm font-bold flex items-center gap-2">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>

            <div class="flex-1 relative">
                <div class="absolute top-4 right-4 z-10">
                    <span class="bg-red-500/10 text-red-500 text-[10px] font-bold px-2 py-1 rounded border border-red-500/20">ENCRYPTED</span>
                </div>
                <textarea id="outputCode" readonly class="w-full h-full p-6 rounded-2xl editor-bg font-mono text-sm text-accent leading-relaxed opacity-80" placeholder="Protected code will appear here..."></textarea>
            </div>
        </div>
    </main>

    <!-- Overlay Loading -->
    <div id="loader" class="fixed inset-0 z-[100] bg-black/90 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 font-bold tracking-widest text-xs">PROCESSING CRYPTOGRAPHY</p>
    </div>

    <script>
        // Default Sample Code for Testing
        window.onload = () => {
            const sample = `/** * IciiObfuscate Test Script
 * Try obfuscating this to see the security layers!
 */
function secureSystem() {
    const privateKey = "ICI-992-SECURE-ID";
    const accessLevel = 5;
    
    console.log("Initializing secure kernel...");
    
    if (accessLevel > 0) {
        return "System Online: " + privateKey;
    }
    return null;
}

secureSystem();`;
            document.getElementById('inputCode').value = sample;
        };

        // Ensure full clipboard support (Select All, Copy, etc)
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(ta => {
            ta.addEventListener('keydown', (e) => {
                // Ensure Ctrl+A or Cmd+A works manually if browser is restrictive
                if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                    ta.select();
                }
            });
        });

        // --- 1. THE INDEPENDENT OBFUSCATOR ENGINE ---
        const IciiEngine = {
            obfuscate: (code) => {
                let cleanCode = code.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm, '');
                const varMap = new Map();
                let varCounter = 0;
                const generateName = () => `_0xici${(varCounter++).toString(16)}`;

                const varRegex = /\b(let|var|const|function)\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g;
                let match;
                while ((match = varRegex.exec(cleanCode)) !== null) {
                    if (!varMap.has(match[2])) varMap.set(match[2], generateName());
                }

                varMap.forEach((newName, oldName) => {
                    const reg = new RegExp(`\\b${oldName}\\b`, 'g');
                    cleanCode = cleanCode.replace(reg, newName);
                });

                cleanCode = cleanCode.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g, (str) => {
                    const content = str.substring(1, str.length - 1);
                    const b64 = btoa(content);
                    return `atob("${b64}")`;
                });

                return `(function(_0xici_stack,_0xici_heap){const _0xici_exec=function(_0xici_data){while(--_0xici_data){_0xici_stack['push'](_0xici_stack['shift']());}};_0xici_exec(++_0xici_heap);}(["IciiObfuscate","v2.0"],0x1a4));\n${cleanCode.trim()}`;
            }
        };

        // --- 2. UI LOGIC ---
        function switchPage(pageNum) {
            const p1 = document.getElementById('page1');
            const p2 = document.getElementById('page2');
            if(pageNum === 1) {
                p1.classList.remove('hidden-page');
                p2.classList.add('hidden-page');
            } else {
                p1.classList.add('hidden-page');
                p2.classList.remove('hidden-page');
            }
        }

        function obfuscateAction() {
            const input = document.getElementById('inputCode').value;
            if(!input.trim()) return;

            const loader = document.getElementById('loader');
            loader.classList.remove('opacity-0', 'pointer-events-none');

            setTimeout(() => {
                try {
                    const result = IciiEngine.obfuscate(input);
                    document.getElementById('outputCode').value = result;
                    loader.classList.add('opacity-0', 'pointer-events-none');
                    switchPage(2);
                } catch(e) {
                    loader.classList.add('opacity-0', 'pointer-events-none');
                    alert("Error: " + e.message);
                }
            }, 800);
        }

        function copyCode() {
            const el = document.getElementById('outputCode');
            el.select();
            document.execCommand('copy');
            const btn = event.currentTarget;
            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copied';
            setTimeout(() => btn.innerHTML = original, 2000);
        }

        function downloadCode() {
            const code = document.getElementById('outputCode').value;
            const blob = new Blob([code], {type: 'text/javascript'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ic_secure_${Date.now()}.js`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // --- 3. PWA LOGIC ---
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('pwaInstall').classList.remove('hidden');
        });

        document.getElementById('pwaInstall').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    document.getElementById('pwaInstall').classList.add('hidden');
                    deferredPrompt = null;
                });
            }
        });
    </script>
</body>
</html>